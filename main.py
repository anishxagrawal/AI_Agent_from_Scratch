from dotenv import load_dotenv
from langchain_groq import ChatGroq
from tools import search, wikipedia, save_text_to_file

load_dotenv()

llm = ChatGroq(model="llama-3.3-70b-versatile", temperature=0)

def research(query: str):
    """Research a topic using available tools"""
    
    print(f"ğŸ” Step 1: Searching Wikipedia for '{query}'...")
    try:
        wiki_result = wikipedia.invoke({"query": query})
        print(f"âœ… Wikipedia found!\n")
    except Exception as e:
        wiki_result = f"Wikipedia search failed: {e}"
        print(f"âš ï¸  Wikipedia error\n")
    
    print(f"ğŸ” Step 2: Searching the web for '{query}'...")
    try:
        search_result = search.invoke({"query": query})
        print(f"âœ… Web search complete!\n")
    except Exception as e:
        search_result = f"Search failed: {e}"
        print(f"âš ï¸  Search error\n")
    
    # Combine results and ask LLM to summarize
    print("ğŸ¤– Step 3: Generating comprehensive answer...\n")
    prompt = f"""Based on the following information about "{query}", provide a clear, well-organized answer:

Wikipedia Information:
{wiki_result}

Web Search Results:
{search_result}

Task: Synthesize the above information into a comprehensive, accurate answer. Structure your response clearly."""
    
    response = llm.invoke(prompt)
    return response.content

def main():
    print("\n" + "="*70)
    print(" ğŸ”¬ AI RESEARCH ASSISTANT ".center(70))
    print("="*70)
    
    query = input("\nWhat can I help you research? ").strip()
    
    if not query:
        print("âŒ Please provide a valid research topic.")
        return
    
    print(f"\n{'='*70}\n")
    
    try:
        result = research(query)
        
        print("="*70)
        print(" ğŸ“Š RESEARCH RESULTS ".center(70))
        print("="*70)
        print(f"\n{result}\n")
        print("="*70)
        
        save_choice = input("\nğŸ’¾ Would you like to save this research? (y/n): ").strip().lower()
        
        if save_choice == 'y':
            filename = input("ğŸ“ Enter filename (default: research_output.txt): ").strip()
            if not filename:
                filename = "research_output.txt"
            elif not filename.endswith('.txt'):
                filename += '.txt'
            
            save_content = f"""RESEARCH TOPIC: {query}

{result}

---
Generated by AI Research Assistant
"""
            save_result = save_text_to_file.invoke({"data": save_content, "filename": filename})
            print(f"\n{save_result}")
        
        print("\nâœ… Research complete!\n")
        
    except Exception as e:
        print(f"\nâŒ Error: {e}")
        print(f"Error type: {type(e).__name__}")

if __name__ == "__main__":
    main()